<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6å¹´ç”Ÿã¸ ãŠãã‚‹ ã‚ã‚ŠãŒã¨ã†ã® ã¦ãŒã¿ (AI ver)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap');

        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: #fff5f7; /* æ¡œè‰² */
            color: #4a4a4a;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(255, 182, 193, 0.3);
            border: 2px solid #ffdae9;
        }

        h1 {
            text-align: center;
            color: #d81b60;
            font-size: 26px;
            margin-bottom: 5px;
            padding-bottom: 10px;
            position: relative;
        }

        h1::after {
            content: 'ğŸŒ¸';
            position: absolute;
            right: 10px;
            bottom: 10px;
            font-size: 20px;
        }

        .subtitle {
            text-align: center;
            font-size: 15px;
            color: #888;
            margin-bottom: 30px;
        }

        .step-box {
            background-color: #fff9fb;
            border: 2px solid #ffc1d6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .step-number {
            background-color: #ff85b2;
            color: white;
            padding: 4px 14px;
            border-radius: 20px;
            font-weight: bold;
            position: absolute;
            top: -12px;
            left: 15px;
            font-size: 14px;
        }

        h3 {
            margin-top: 5px;
            font-size: 18px;
            color: #d81b60;
        }

        .guide-text {
            font-size: 14px;
            color: #666;
            background-color: #fff0f5;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px dashed #ffc1d6;
            border-radius: 10px;
            background-color: #fff;
            font-family: 'Kosugi Maru', sans-serif;
            margin-top: 5px;
            box-sizing: border-box;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #d81b60;
            background-color: #fff;
        }

        .hint-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        /* ãƒ’ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ */
        .hint-card {
            background-color: #fff;
            border: 2px solid #fce4ec;
            border-radius: 10px;
            width: 145px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
        }
        .hint-card:hover {
            transform: scale(1.03);
            border-color: #ff85b2;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .hint-card .img-box {
            height: 80px;
            background-color: #fff5f8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
        }

        .hint-card p {
            padding: 6px;
            font-size: 12px;
            margin: 0;
            text-align: center;
            background-color: #fff;
            line-height: 1.3;
        }
        
        .hint-tag {
            background-color: #fce4ec;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
            color: #d81b60;
        }
        .hint-tag:hover {
            background-color: #ffc1d6;
        }

        .emotion-options {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .emotion-btn {
            background-color: white;
            border: 2px solid #ffd1e0;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            width: 110px;
            transition: all 0.2s;
        }

        .emotion-btn.selected {
            border-color: #ff85b2;
            background-color: #fff0f5;
            font-weight: bold;
            transform: scale(1.05);
        }

        .emotion-icon {
            font-size: 28px;
            display: block;
            margin-bottom: 5px;
        }

        .final-draft {
            background-color: #fffafa;
            border: 3px double #ffb6c1;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-main {
            display: block;
            width: 240px;
            margin: 10px auto;
            padding: 15px;
            background-color: #ff85b2;
            color: white;
            text-align: center;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #d81b60;
        }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }

        .btn-secondary {
            padding: 10px 20px;
            background-color: #f06292;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        /* AI Buttons */
        .btn-ai {
            background-color: #9c27b0;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        #checkMessage {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-size: 14px;
        }
        .msg-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .msg-warning { background-color: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; }

        /* Loading Overlay */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff85b2;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media print {
            body { background-color: white; padding: 0; }
            .container { box-shadow: none; border: none; width: 100%; }
            .btn-main, .button-group, .hint-tag, .btn-ai, .hint-container, .step-number { display: none; }
            .step-box { border: 1px solid #eee; padding: 10px; }
        }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div class="spinner"></div>
    <p style="margin-top: 10px; color: #d81b60; font-weight: bold;">AIãŒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...</p>
</div>

<div class="container">
    <h1>6å¹´ç”Ÿã¸ ã‚ã‚ŠãŒã¨ã† ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ</h1>
    <p class="subtitle">ãã¤ãã‚‡ã†ã™ã‚‹ ãŠå…„ã•ã‚“ãƒ»ãŠå§‰ã•ã‚“ã« ãŠãã‚‹ ã¦ãŒã¿ã‚’ ã¤ãã‚ã†ï¼</p>

    <!-- STEP 1 -->
    <div class="step-box">
        <span class="step-number">Step 1</span>
        <h3>ã ã‚Œã« ãŠãã‚‹ï¼Ÿ</h3>
        <div class="guide-text">
            ã‚ã‚ŠãŒã¨ã†ã‚’ ã¤ãŸãˆãŸã„ 6å¹´ç”Ÿã®åå‰ã‚’ ã‹ã“ã†ã€‚<br>
            ï¼ˆä¾‹ï¼šã€‡ã€‡ç­ã®ã€‡ã€‡ã•ã‚“ã€ã€‡ã€‡å§”å“¡ä¼šã®ã€‡ã€‡å…ˆè¼©ï¼‰
        </div>
        <input type="text" id="who" placeholder="ï¼ˆä¾‹ï¼‰ç™»æ ¡ç­ã® ã•ãã‚‰ã•ã‚“">
    </div>

    <!-- STEP 2 -->
    <div class="step-box">
        <span class="step-number">Step 2</span>
        <h3>ã©ã‚“ãª æ€ã„å‡ºãŒ ã‚ã‚‹ï¼Ÿ</h3>
        <div class="guide-text">
            ã„ã£ã—ã‚‡ã« ã—ã¦ æ¥½ã—ã‹ã£ãŸã“ã¨ã‚„ã€ã†ã‚Œã—ã‹ã£ãŸã“ã¨ã‚’ ãŠã‚‚ã„å‡ºãã†ã€‚<br>
            ãŠã‚‚ã„å‡ºã›ãªã„ã¨ãã¯ã€ã€ŒAIãƒ’ãƒ³ãƒˆã€ã‚’ãŠã—ã¦ã¿ã¦ã­ã€‚
        </div>
        <input type="text" id="what" placeholder="ï¼ˆä¾‹ï¼‰ãã†ã˜ã® ã‚„ã‚Šæ–¹ã‚’ ã‚„ã•ã—ã ãŠã—ãˆã¦ãã‚ŒãŸ">
        
        <button class="btn-ai" onclick="getGraduationHints()">
            âœ¨ 6å¹´ç”Ÿã¨ã®æ€ã„å‡ºãƒ’ãƒ³ãƒˆ
        </button>

        <div class="hint-container" id="hintContainer">
            <span class="hint-tag" onclick="setInput('what', 'ç™»æ ¡ç­ã§ ã‚„ã•ã—ã ã“ãˆã‚’ ã‹ã‘ã¦ãã‚ŒãŸ')">ç™»æ ¡ç­</span>
            <span class="hint-tag" onclick="setInput('what', 'å§”å“¡ä¼šã§ ãŠã—ã”ã¨ã‚’ ã‚„ã•ã—ã ãŠã—ãˆã¦ãã‚ŒãŸ')">å§”å“¡ä¼š</span>
            <span class="hint-tag" onclick="setInput('what', 'æ˜¼ä¼‘ã¿ã« ã„ã£ã—ã‚‡ã« ã‚ãã‚“ã§ãã‚ŒãŸ')">æ˜¼ä¼‘ã¿</span>
            <span class="hint-tag" onclick="setInput('what', 'é‹å‹•ä¼šã§ ã„ã£ã—ã‚‡ã†ã‘ã‚“ã‚ã„ å¿œæ´ã—ã¦ãã‚ŒãŸ')">é‹å‹•ä¼š</span>
        </div>
    </div>

    <!-- STEP 3 -->
    <div class="step-box">
        <span class="step-number">Step 3</span>
        <h3>ã‚ãªãŸã® ãã‚‚ã¡ã¯ï¼Ÿ</h3>
        <div class="guide-text">
            6å¹´ç”Ÿã‚’ ã¿ã¦ã„ã¦ã€ã©ã† æ€ã£ãŸã‹ãªï¼Ÿ
        </div>
        <div class="emotion-options">
            <div class="emotion-btn" onclick="selectEmotion(this, 'ã‹ã£ã“ã‚ˆã‹ã£ãŸ')">
                <span class="emotion-icon">âœ¨</span>
                ã‹ã£ã“ã‚ˆã‹ã£ãŸ
            </div>
            <div class="emotion-btn" onclick="selectEmotion(this, 'ã‚„ã•ã—ã‹ã£ãŸ')">
                <span class="emotion-icon">ğŸŒ¸</span>
                ã‚„ã•ã—ã‹ã£ãŸ
            </div>
            <div class="emotion-btn" onclick="selectEmotion(this, 'ã‚ã“ãŒã‚Œã ã£ãŸ')">
                <span class="emotion-icon">ğŸ’</span>
                ã‚ã“ãŒã‚Œ
            </div>
            <div class="emotion-btn" onclick="selectEmotion(this, 'ã•ã³ã—ããªã‚‹ã‚ˆ')">
                <span class="emotion-icon">ğŸ˜¢</span>
                ã•ã³ã—ã„
            </div>
        </div>
        <input type="hidden" id="feeling">
        <input type="text" id="otherFeeling" style="margin-top:10px" placeholder="ï¼ˆä¾‹ï¼‰ã˜ã¶ã‚“ã‚‚ ã€‡ã€‡ã•ã‚“ã®ã‚ˆã†ã« ãªã‚ŠãŸã„" oninput="clearEmotionSelection()">
    </div>

    <!-- STEP 4 -->
    <div class="step-box">
        <span class="step-number">Step 4</span>
        <h3>ã“ã‚Œã‹ã‚‰ã® ãŠã†ãˆã‚“</h3>
        <div class="guide-text">
            ä¸­å­¦æ ¡ã« è¡Œã 6å¹´ç”Ÿã«ã€ãªã‚“ã¦ è¨€ã„ãŸã„ã‹ãªï¼Ÿ
        </div>
        <input type="text" id="future" placeholder="ï¼ˆä¾‹ï¼‰ä¸­å­¦æ ¡ã§ã‚‚ å‹‰å¼·ã‚„ éƒ¨æ´»ã‚’ ãŒã‚“ã°ã£ã¦ã­">
        <div class="hint-container">
            <span class="hint-tag" onclick="setInput('future', 'ä¸­å­¦æ ¡ã§ã‚‚ ãŠã†ãˆã‚“ã—ã¦ã„ã¾ã™')">ãŠã†ãˆã‚“</span>
            <span class="hint-tag" onclick="setInput('future', 'ä¸­å­¦æ ¡ã§ã‚‚ ç¬‘é¡”ã§ ãŒã‚“ã°ã£ã¦ã­')">ç¬‘é¡”ã§</span>
            <span class="hint-tag" onclick="setInput('future', 'ã¾ãŸ å­¦æ ¡ã« ã‚ãã³ã« ãã¦ã­')">ã‚ãã³ã«ãã¦ã­</span>
        </div>
    </div>

    <button class="btn-main" onclick="generateLetter()">ã¦ãŒã¿ã® æ–‡ç« ã‚’ ã¤ãã‚‹ï¼</button>

    <!-- FINAL OUTPUT -->
    <div class="final-draft">
        <h3>âœ¨ ã§ãã‚ãŒã£ãŸ ã¦ãŒã¿ âœ¨</h3>
        <textarea id="finalText" rows="10" placeholder="ã“ã“ã« æ–‡ç« ãŒ ã§ãã‚ãŒã‚Šã¾ã™ã€‚"></textarea>
        
        <div style="text-align: right; margin-top:10px;">
            <button class="btn-ai" onclick="polishTextWithAI()">
                âœ¨ é­”æ³•ã®ãƒšãƒ³ (ã‚‚ã£ã¨ æ¸©ã‹ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«)
            </button>
        </div>

        <div id="checkMessage"></div>

        <div class="button-group">
            <button class="btn-secondary" style="background-color:#ff85b2;" onclick="checkText()">ğŸ‘€ ãƒã‚§ãƒƒã‚¯ã™ã‚‹</button>
            <button class="btn-secondary" style="background-color:#666;" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
        </div>
    </div>
</div>

<script>
    const apiKey = ""; // Runtime provides the key

    async function callGeminiAPI(userPrompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        const payload = { contents: [{ parts: [{ text: userPrompt }] }] };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text;
        } catch (error) {
            console.error(error);
            return null;
        }
    }

    async function getGraduationHints() {
        const who = document.getElementById('who').value || "6å¹´ç”Ÿ";
        const loadingOverlay = document.getElementById('loadingOverlay');
        loadingOverlay.style.display = 'flex';

        const prompt = `
            ã‚ãªãŸã¯å°å­¦æ ¡ã®å…ˆç”Ÿã§ã™ã€‚ä¸‹ç´šç”ŸãŒå’æ¥­ã™ã‚‹ "${who}" ã•ã‚“ã«æ„Ÿè¬ã®æ‰‹ç´™ã‚’æ›¸ã“ã†ã¨ã—ã¦ã„ã¾ã™ã€‚
            å°å­¦æ ¡ã®ã€Œç™»æ ¡ç­ã€ã€Œã‚¯ãƒ©ãƒ–ã€ã€Œå§”å“¡ä¼šã€ã€Œæƒé™¤ã€ã€Œè¡Œäº‹ã€ãªã©ã§ã®å…·ä½“çš„ã§å„ªã—ã„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’3ã¤è€ƒãˆã¦ãã ã•ã„ã€‚
            
            å½¢å¼: JSONé…åˆ—ã®ã¿
            [
                { "text": "ãã†ã˜ã§ ã‚„ã‚Šæ–¹ã‚’ ã‚„ã•ã—ã ãŠã—ãˆã¦ãã‚ŒãŸ", "emoji": "ğŸ§¹" },
                { "text": "ã‚¯ãƒ©ãƒ–æ´»å‹•ã§ ã„ã£ã—ã‚‡ã« æ¥½ã—ã ã‚ãã‚“ã§ãã‚ŒãŸ", "emoji": "âš½" },
                { "text": "ç™»æ ¡ç­ã§ ã‚ã¶ãªã„ã¨ãã« æ‰‹ã‚’ ã¤ãªã„ã§ãã‚ŒãŸ", "emoji": "ğŸ’" }
            ]
            â€»å…¨ã¦ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã®ã¿ã§ç­”ãˆã¦ãã ã•ã„ã€‚
        `;

        const resultText = await callGeminiAPI(prompt);
        loadingOverlay.style.display = 'none';

        if (resultText) {
            try {
                const cleanJson = resultText.replace(/```json/g, '').replace(/```/g, '').trim();
                const hints = JSON.parse(cleanJson);
                const container = document.getElementById('hintContainer');
                
                hints.forEach(hint => {
                    const card = document.createElement('div');
                    card.className = 'hint-card';
                    card.onclick = () => setInput('what', hint.text);
                    card.innerHTML = `<div class="img-box">${hint.emoji}</div><p>${hint.text}</p>`;
                    container.prepend(card);
                });
            } catch (e) {
                console.error("Parse error", e);
            }
        }
    }

    async function polishTextWithAI() {
        const currentText = document.getElementById('finalText').value;
        if (!currentText) return;
        
        const loadingOverlay = document.getElementById('loadingOverlay');
        loadingOverlay.style.display = 'flex';

        const prompt = `
            ä»¥ä¸‹ã®æ–‡ç« ã¯ã€å°å­¦ç”ŸãŒå’æ¥­ã™ã‚‹6å¹´ç”Ÿã«å‘ã‘ã¦æ›¸ã„ãŸæ„Ÿè¬ã®æ‰‹ç´™ã§ã™ã€‚
            å­ä¾›ã‚‰ã—ã„ç´ ç›´ãªè¡¨ç¾ã‚’ä¿ã¡ã¤ã¤ã€ã‚ˆã‚Šæ„Ÿå‹•çš„ã§æ¸©ã‹ã„ã€æ­£ã—ã„æ—¥æœ¬èªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç›´ã—ã¦ãã ã•ã„ã€‚
            ä¿®æ­£å¾Œã®æœ¬æ–‡ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚
            
            å…ƒæ–‡ç« : "${currentText}"
        `;

        const polished = await callGeminiAPI(prompt);
        loadingOverlay.style.display = 'none';
        if (polished) document.getElementById('finalText').value = polished.trim();
    }

    function setInput(id, text) {
        document.getElementById(id).value = text;
    }

    function selectEmotion(element, text) {
        document.getElementById('otherFeeling').value = '';
        document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('feeling').value = text;
    }

    function clearEmotionSelection() {
        document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('selected'));
        document.getElementById('feeling').value = '';
    }

    function generateLetter() {
        const who = document.getElementById('who').value;
        const what = document.getElementById('what').value;
        const feeling = document.getElementById('otherFeeling').value || document.getElementById('feeling').value;
        const future = document.getElementById('future').value;

        if (!who || !what) {
            showMessage("åå‰ã¨ æ€ã„å‡ºã‚’ ã‹ã„ã¦ã­ï¼", "warning");
            return;
        }

        let letter = `${who} ã•ã‚“ã¸\n\n`;
        letter += `ã”å’æ¥­ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚\n`;
        letter += `ã€‡ã€‡ã•ã‚“ã¯ã€ã„ã¤ã‚‚ ${what}ã­ã€‚\n`;
        if (feeling) letter += `ãã‚“ãª ã€‡ã€‡ã•ã‚“ã¯ã€ã‚ãŸã—ã«ã¨ã£ã¦ ${feeling}ãª å­˜åœ¨ã§ã—ãŸã€‚\n`;
        letter += `ä»Šã¾ã§ æœ¬å½“ã« ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n`;
        if (future) letter += `ä¸­å­¦æ ¡ã§ã‚‚ã€${future}ï¼\n`;
        letter += `ãšã£ã¨ ãŠã†ãˆã‚“ã—ã¦ã„ã¾ã™ã€‚`;

        document.getElementById('finalText').value = letter;
    }

    function checkText() {
        const text = document.getElementById('finalText').value;
        if (!text) return;
        
        const msg = document.getElementById('checkMessage');
        msg.style.display = 'block';
        if (text.includes('ã‚ã‚ŠãŒã¨ã†') && text.includes('ãŠã‚ã§ã¨ã†')) {
            msg.className = 'msg-success';
            msg.innerHTML = "âœ… ã¨ã¦ã‚‚ ã™ã¦ããª å’æ¥­ãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã­ï¼";
            speak(text);
        } else {
            msg.className = 'msg-warning';
            msg.innerHTML = "âš ï¸ ã€ŒãŠã‚ã§ã¨ã†ã€ã‚„ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’ ã„ã‚Œã‚‹ã¨ ã‚‚ã£ã¨ ã‚ˆããªã‚‹ã‚ˆï¼";
        }
    }

    function showMessage(html, type) {
        const msgDiv = document.getElementById('checkMessage');
        msgDiv.style.display = 'block';
        msgDiv.innerHTML = html;
        msgDiv.className = type === 'success' ? 'msg-success' : 'msg-warning';
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = 'ja-JP';
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(uttr);
        }
    }
</script>

</body>
</html>
